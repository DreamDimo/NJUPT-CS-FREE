# 浮点数相关 (IEEE 754)

> 《CS:APP 2.4 浮点数》 相关内容的笔记
> 贡献者: [BlockLune](https://github.com/BlockLune)
> 贡献时间: 2024-06-30
> 许可证：[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)

---

二进制小数的组成：$b_m...b_2b_1b_0.b_{-1}b_{-2}...b_{-n}$

表示的数值大小：

- 例如 $11.011_2$ 表示的数值大小为 $1 \times 2^1 + 1 \times 2^0 + 0 \times 2^{-1} + 1 \times 2^{-2} + 1 \times 2^{-3} = 3 \frac{3}{8}$

---

IEEE 754 标准（IEEE 读作 “eye-triple-ee”）

使用 $V=(-1)^s\times M\times2^E$ 来表示一个数：

- $s$：符号（sign）
- $M$：尾数（significand）
- $E$：阶码（exponent）

编码方式：

- 一个单独的符号位用于编码 $s$
- $k$ 位阶码字段 `exp` 用于编码 $E$，位表示为 $e_{k-1}...e_1e_0$
- $n$ 位小数字段 `frac` 用于编码 $M$，位表示为 $f_{n-1}...f_1f_0$

根据 `exp` 的值，被编码的值可以分为三种情况：

- **规格化的**： `exp`所有位既不全为 0 又不全为 1
- **非规格化的**： `exp` 所有位全为 0，提供了表示数值 0 的方法和被称之为**逐渐溢出**的属性
- `exp` 全为 1 的情况（存在两个变种）：
  - 无穷大： `exp` 全为 1，同时 `frac` 全为 0
  - NaN（非数）： `exp` 全为 1，同时 `frac` 不全为 0

👆 **三种情况的编码方式不完全一样！**

- 规格化的
  - $E=e-Bias$
    - $e$ 的二进制位表示为 $e_{k-1}...e_1e_0$
    - $Bias=2^{k-1}-1$
  - $M=1+f$（隐含的以 1 开头的（implied leading 1）表示）
    - $f$ 的二进制位表示为 $0.f_{n-1}...f_1f_0$（$0\leq f \lt 1$）
- 非规格化的
  - $E=1-Bias$
    - 非规格化数的 `exp` 字段全为 0，所以直觉上（上边的规格化的情况）这里应该是 $0 - Bias$，但**事实上不是这样**
    - $Bias=2^{k-1}-1$
  - $M = f$
    - 这就是为什么上面用的是 $1-Bias$

---

速记表格：

| 类型       | $E$      | $M$   |
| ---------- | -------- | ----- |
| 规格化的   | $e-Bias$ | $1+f$ |
| 非规格化的 | $1-Bias$ | $f$   |
